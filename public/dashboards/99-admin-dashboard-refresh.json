{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# Dashboard Refresh Control\n\n## How to Use\n\n1. **Click the \"Refresh Dashboards\" button** on the right panel\n2. Wait 10-15 seconds for the refresh to complete\n3. **Reload this page** (F5 or Ctrl+R) to see new dashboards\n\n## What This Does\n\n- Downloads latest dashboard JSON files from GitHub\n- Updates existing dashboards if changed\n- Adds new dashboards automatically\n- No container restart required!\n\n## Current Dashboards\n\nThis system currently manages **14 dashboards**:\n\n1. Dashboard Browser\n2. SQL Monitor - Home\n3. SQL Server Monitoring - Overview\n4. Table Browser\n5. Table Details\n6. Code Browser\n7. Performance Analysis\n8. Query Store Analysis\n9. Audit Logging (SOC 2)\n10. Insights - 24h Priorities\n11. **AWS RDS Performance Insights** ‚≠ê NEW\n12. DBCC Integrity Checks\n13. Detailed Metrics View\n14. SQL Server Performance Overview\n\n## Troubleshooting\n\n**Button doesn't work?**\n- Check webhook server is running: `ps aux | grep webhook`\n- Check logs: `cat /var/log/dashboard-refresh.log`\n\n**New dashboards not appearing?**\n- Wait 30 seconds after clicking button\n- Hard refresh browser: Ctrl+Shift+R\n- Check GitHub for latest: https://github.com/dbbuilder/sql-monitor/tree/main/public/dashboards\n\n---\n\n**Last Updated:** 2025-10-30",
        "mode": "markdown"
      },
      "pluginVersion": "10.2.0",
      "title": "Dashboard Refresh Instructions",
      "type": "text"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 2,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# üîÑ Refresh Dashboards from GitHub\n\n<div style=\"text-align: center; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; margin: 20px 0;\">\n  <h2 style=\"color: white; margin-bottom: 15px; font-size: 24px;\">‚ö° Dashboard Auto-Refresh</h2>\n  <p style=\"color: #ffeb3b; margin-bottom: 15px; font-size: 16px; font-weight: bold;\">‚ö†Ô∏è Port 8888 not exposed - Use manual method below</p>\n  <p style=\"color: white; margin-bottom: 20px; font-size: 14px;\">Dashboards update automatically on container restart</p>\n</div>\n\n---\n\n## üõ†Ô∏è Manual Refresh Methods\n\n### Method 1: Azure Portal (Easiest)\n\n1. Go to: [Azure Portal ‚Üí Container Instances](https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ContainerInstance%2FcontainerGroups)\n2. Select: **rg-sqlmonitor-schoolvision** ‚Üí **grafana-schoolvision**\n3. Click: **Restart** button\n4. Wait: 60 seconds for startup + dashboard download\n5. Reload: This Grafana page (F5)\n\n‚úÖ **New dashboards loaded automatically on restart!**\n\n---\n\n### Method 2: Azure CLI (From PowerShell/Terminal)\n\nCopy and paste this command:\n\n<div style=\"background: #1e1e1e; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #4CAF50;\">\n  <code style=\"color: #4CAF50; font-size: 14px; font-family: 'Courier New', monospace; display: block; white-space: pre-wrap;\">az container restart --resource-group rg-sqlmonitor-schoolvision --name grafana-schoolvision</code>\n</div>\n\n**Then:** Wait 60 seconds and reload this page (F5)\n\n---\n\n### Method 3: PowerShell Deployment Script (Full Update)\n\nRun from project directory:\n\n<div style=\"background: #1e1e1e; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196F3;\">\n  <code style=\"color: #2196F3; font-size: 14px; font-family: 'Courier New', monospace; display: block; white-space: pre-wrap;\">D:\\Dev2\\sql-monitor\\Deploy-Grafana-Update-ACR.ps1</code>\n</div>\n\nThis rebuilds the image and restarts the container (3-5 minutes)\n\n---\n\n### Method 4: Direct Container Exec (Advanced)\n\nExecute refresh script directly in container:\n\n<div style=\"background: #1e1e1e; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #FF9800;\">\n  <code style=\"color: #FF9800; font-size: 14px; font-family: 'Courier New', monospace; display: block; white-space: pre-wrap;\">az container exec \\<br/>  --resource-group rg-sqlmonitor-schoolvision \\<br/>  --name grafana-schoolvision \\<br/>  --exec-command \"bash /dashboard-refresh.sh\"</code>\n</div>\n\n---\n\n## üìù Why No Web Button?\n\n<div style=\"background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin: 15px 0;\">\n  <strong>Technical Limitation:</strong> Port 8888 (webhook server) is not exposed in Azure Container Instance configuration. <br/><br/>\n  <strong>Current Setup:</strong> Only port 3000 (Grafana) is publicly accessible.<br/><br/>\n  <strong>Solution:</strong> Use container restart (Method 1 or 2) which automatically downloads latest dashboards on startup.\n</div>\n\n---\n\n## ‚ú® What Happens on Refresh?\n\n1. **Downloads** latest dashboard JSON from GitHub\n2. **Updates** existing dashboards if changed  \n3. **Adds** new dashboards automatically\n4. **No data loss** - all Grafana config preserved\n\n**Current Dashboards:** 15 (including AWS RDS Performance Insights)",
        "mode": "html"
      },
      "pluginVersion": "10.2.0",
      "title": "Refresh Button",
      "type": "text"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 3,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "## Refresh Logs\n\nLast refresh log output:\n\n```bash\n# View in container:\ncat /var/log/dashboard-refresh.log\n\n# Or exec into container:\naz container exec --resource-group <RG> --name <NAME> \\\n  --exec-command \"cat /var/log/dashboard-refresh.log\"\n```\n\n## Expected Output\n\n```\n==========================================\nGRAFANA DASHBOARD REFRESH\n==========================================\nWed Oct 30 16:00:00 UTC 2025\n\nStep 1: Downloading latest dashboards from GitHub...\n  Downloading 00-dashboard-browser.json...\n    ‚óã No change\n  Downloading 00-landing-page.json...\n    ‚óã No change\n  ...\n  Downloading 08-aws-rds-performance-insights.json...\n    ‚úì New dashboard\n  ...\n\nDownload Summary:\n  Total dashboards: 14\n  Downloaded: 14\n  Updated: 1\n  Failed: 0\n\nStep 2: Fixing permissions...\n  Permissions updated\n\nStep 3: Triggering Grafana provisioning reload...\n  ‚úì Grafana API responsive\n  ‚úì Dashboard count: 14\n\n==========================================\nREFRESH COMPLETE\n==========================================\n\nWhat to do next:\n  1. Dashboards updated! (1 files changed)\n  2. Restart Grafana to load new dashboards:\n     docker restart <container-name>\n  OR\n  3. Wait for Grafana's auto-reload (may take 1-2 minutes)\n```",
        "mode": "markdown"
      },
      "pluginVersion": "10.2.0",
      "title": "Refresh Logs",
      "type": "text"
    }
  ],
  "refresh": "",
  "schemaVersion": 38,
  "style": "dark",
  "tags": [
    "admin",
    "maintenance"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Admin - Dashboard Refresh (Build: 2025-11-10 08:34:54 UTC)",
  "uid": "admin-dashboard-refresh",
  "version": 1,
  "weekStart": ""
}
